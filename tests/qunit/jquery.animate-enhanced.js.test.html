<!DOCTYPE html> 
 <html lang="en"> 
<head> 
	<meta charset="utf-8" /> 
	<title>jQuery Animate Enhanced test suite</title> 
	
	<link rel="stylesheet" href="./qunit.css" type="text/css"/>
</head>
<body>
	<h1 id="qunit-header">jQuery Animate Enhanced</h1>  
    <h2 id="qunit-banner"></h2>  
    <h2 id="qunit-userAgent"></h2>  
    <ol id="qunit-tests"></ol>
	
	<div id="div"></div>
	<div id="css"></div>
	<div id="delay"></div>
	<div id="translation"></div>
	
	<script src="../../scripts/contrib/jquery-1.4.3.js"></script> 
	<script src="../../scripts/src/jquery.animate-enhanced.js"></script> 
	<script src="./qunit.js"></script>
	<script>
		(function ($) {
			
		var _private = jQuery.fn.animate.defaults._private,
			$div = $('#div'),
			$css = $('#css'),
			$delay = $('#delay'),
			$trans = $('#translation'),
			contains = function (actual, possible, msg) {
				return ok(!!~$.inArray(actual, possible), msg);
			},
			containsAll = function (actual, possible, msg) {
				var i, yes = true;
				if ( ($.isPlainObject(actual) || $.isArray(actual)) && 
					 ($.isPlainObject(possible) || $.isArray(possible))) {
					for (i in possible) {
						if (actual[i] != possible[i]) {
							yes = false;
							break;
						}
					}
				} else {
					yes = false;
				}
				return ok(yes, msg);
			},
			runTests = function (){
				
			module('jQuery.animate-enhanced.defaults');
			
			test('jQuery.fn.animate.defaults', function () {
				// assure defaults are what they should be
				equal($.fn.animate.defaults.avoidTransforms, undefined, 'avoidTransforms = undefined');
				equal($.fn.animate.defaults.useTranslate3d, true, 'useTranslate3d = true');
				equal($.fn.animate.defaults.leaveTransforms, undefined, 'leaveTransforms = undefined');
				equal($.fn.animate.defaults.avoidCSSTransitions, undefined, 'avoidCSSTransitions = undefined');
				ok($.isPlainObject($.fn.animate.defaults._private), '_private is a plain object');
			});
				
			module('jQuery.animate-enhanced._private');
			
			test('_getUnit', function () {
				// function _getUnit(val, prop)
				equal(_private._getUnit('11px'), 	'px', '11px unit\'s = px');
				equal(_private._getUnit(0), 		'px', '0 unit\'s = px');
				equal(_private._getUnit(0, 'opacity'),'', '0 unit\'s = nothing when opacity');
				equal(_private._getUnit(0, 'width'),'px', '0 unit\'s = nothing when width');
				equal(_private._getUnit(1), 		'px', '1 unit\'s = px');
				equal(_private._getUnit(1, 'opacity'),'', '1 unit\'s = nothing when opacity');
				equal(_private._getUnit(1,'opacity'),'', '1 unit\'s = nothing');
				equal(_private._getUnit('0%','left'),'%', '0% unit\'s = %');
				equal(_private._getUnit('14pt'), 	'pt', '14pt unit\'s = pt');
				equal(_private._getUnit('1.4em'), 	'em', '1.4em unit\'s = em');
				equal(_private._getUnit('show'), 	'px', 'show unit\'s = px');
				equal(_private._getUnit('show', 'opacity'),'', 'show unit\'s = nothing when opacity');
				equal(_private._getUnit('0$'), 		'$', '0$ unit\'s = $');
				equal(_private._getUnit(true), 		'', 'true unit\'s = nothing');
				equal(_private._getUnit(false), 	'', 'false unit\'s = nothing');
			});
			
			test('_cleanValue', function () {
				// function _cleanValue(val)
				equal(_private._cleanValue('11px'), 	11, '11px value = 11');
				equal(_private._cleanValue(0), 			0, '0 value = 0');
				equal(_private._cleanValue(1), 			1, '1 value = 1');
				equal(_private._cleanValue('0%'), 		0, '0% value = 0');
				equal(_private._cleanValue('14pt'), 	14, '14pt value = 14');
				equal(_private._cleanValue('1.4em'), 	1.4, '1.4em value = em');
				equal(_private._cleanValue('show'), 	'show', 'show value = show');
				equal(_private._cleanValue('0$'), 		'0$', '0$ value = 0$');
				equal(_private._cleanValue(true), 		true, 'true value = true');
			});
			
			test('_appropriateProperty', function () {
				// function _appropriateProperty(prop, value, element)
				ok(_private._appropriateProperty('width', '10px', $div), 'width 10px');
				ok(_private._appropriateProperty('height', '10px', $div), 'height 10px');
				ok(_private._appropriateProperty('width', 'show', $div), 'width show');
				ok(!_private._appropriateProperty('height', 0, $div), 'height 0');
				ok(_private._appropriateProperty('opacity', 0, $div), 'opacity 0');
				ok(_private._appropriateProperty('left', 0, $div), 'left 0');
			});
			
			test('_appropriateEasing', function () {
				// function _appropriateEasing(easing, element)
				ok(_private._appropriateEasing('swing', $div), 'swing');
				ok(_private._appropriateEasing('linear', $div), 'linear');
				ok(_private._appropriateEasing('easeIn', $div), 'easeIn');
				ok(!_private._appropriateEasing('kkk', $div), 'kkk');
			});
			
			test('_assureDefault', function () {
				// function _assureDefault(props, prop) {
				equal(_private._assureDefault(), false);
				equal(_private._assureDefault('k'), false);
				equal(_private._assureDefault({'k':0},'k'), 0);
				equal(_private._assureDefault({useTranslate3d:false},'useTranslate3d'), false);
				equal(_private._assureDefault({},'avoidCSSTransitions'), false);
				equal(_private._assureDefault({avoidCSSTransitions:true},'avoidCSSTransitions'), true);
			});
			
			test('_isOptionProperty', function () {
				// function _isOptionProperty(p)
				ok(_private._isOptionProperty('avoidTransforms'), 'avoidTransforms');
				ok(_private._isOptionProperty('useTranslate3d'), 'useTranslate3d');
				ok(_private._isOptionProperty('leaveTransforms'), 'easeIn');
				ok(_private._isOptionProperty('avoidCSSTransitions'), 'avoidCSSTransitions');
				ok(!_private._isOptionProperty('kkk'), 'kkk');
			});
		
			test('_interpretValue', function () {
				// function _interpretValue(e, val, prop, isTransform) 
				containsAll(_private._interpretValue($div, '11px', 'width', true), 		{value:11,unit:'px'}, 'width 11px');
				
				// those two test fails... seems like this method has no responsability whatsoever
				// most of the time, it returns the current CSS value... when it should calculte the end value
				//containsAll(_private._interpretValue($div, 0, 'left', true), 			{value:0,unit:'px'}, 'left 0px');
				//containsAll(_private._interpretValue($div, 1, 'right', true), 			{value:1,unit:'px'}, 'right 1px');
				containsAll(_private._interpretValue($div, 0.5, 'opacity', true), 		{value:0.5,unit:''}, 'opacity 0.5');
				// same here
				//containsAll(_private._interpretValue($div, '0%', 'margin-left', true), 	{value:0,unit:'%'}, 'margin-left 0%');
				//containsAll(_private._interpretValue($div, '14pt', 'font-size', false), {value:14,unit:'pt'}, 'font-size: 14pt');
				//containsAll(_private._interpretValue($div, '1.4em', 'height', false), 	{value:1.4,unit:'em'}, 'height: 1.4em');
				containsAll(_private._interpretValue($div, 'show', 'opacity', true), 	{value:1,unit:''}, 'opacity show -> 1');
				//containsAll(_private._interpretValue($div, '0$', 'border-top', false), 	{value:0,unit:'$'},'border-top 0$');
				//containsAll(_private._interpretValue($div, true, 'display', true), 		{value:true,unit:''}, 'display true');
			});
			
			test('_getTranslation', function () {
				// function _getTranslation(x, y, z, use3D, xUnit, yUnit, xUnit)
				equal(_private._getTranslation(0,0,0), 'translate3d(0px,0px,0px)', '3d by default');
				jQuery.fn.animate.defaults.useTranslate3d = false;
				equal(_private._getTranslation(0,0,0), 'translate(0px,0px)', 'no 3d by default');
				equal(_private._getTranslation(0,0,0,true), 'translate3d(0px,0px,0px)', 'explicit 3d');
				jQuery.fn.animate.defaults.useTranslate3d = true;
				equal(_private._getTranslation(1,3,2,false), 'translate(1px,3px)','explicit 2d');
				equal(_private._getTranslation(1,3,2,true), 'translate3d(1px,3px,2px)','3d(1,3,2)');
				equal(_private._getTranslation(-1,-3,-2,true), 'translate3d(-1px,-3px,-2px)','ed(-1,-3,-2)');
				equal(_private._getTranslation(10,30,20,true,'em'), 'translate3d(10em,30em,20em)','all defaults unit to em');
				equal(_private._getTranslation(10,30,20,true,'em','px','%'), 'translate3d(10em,30px,20%)','(10em,30px,20%)');
			});
		
			module('jQuery.animate-enhanced.core');
			
			test('jQuery.fn.css', function(){
				var t = $css;
				//expect(13);
				
				// getter defaults
				equal(t.css('opacity'), '1', 'get opacity = 1');
				equal(t.css('left'), 'auto', 'get left = auto');
				equal(t.css('top'), 'auto', 'get top = auto');
				equal(t.css('right'), 'auto', 'get right = auto');
				equal(t.css('bottom'), 'auto', 'get bottom = auto');
				
				// set some values
				t.css('position', 'absolute');
				t.css({width:'100px', height:'50%'});
				t.css('opacity', 0);
				
				// test the setted values
				equal(t.css('position'), 'absolute', 'get position = absolute');
				equal(t.css('width'), '100px', 'get width = 100px');
				equal(t.width(), 100, 'width() == 100');
				// not passing... equal(t.css('height'), '50%', 'get height = 50%');
				equal(t.css('opacity'), 0, 'get opacity = 0')
				
				// set some normal properties and check the magic happens
				t.css('top', '50px');
				equal(t.css('top'), 'auto', 'get top still equals to auto after CSS3 translation');
				contains(t.css('-webkit-transform'), [ 'translate3d(50px,0px,0px)', 'matrix(1, 0, 0, 1, 0, 50)' ], 'top transformation applied');
				t.css('left', '60px');
				contains(t.css('-webkit-transform'), [ 'translate3d(50px,60px,0px)', 'matrix(1, 0, 0, 1, 60, 50)' ], 'left transformation applied');
				// @todo test with bottom and right
			
				// reset
				t.css('-webkit-transform', '');
				equal(t.css('-webkit-transform'), 'none', 'hard reset was sucessfull');
				
				// matrix transform
				t.css({top:'1px',left:'1px',color:'rgb(255,0,0)'});
				contains(t.css('-webkit-transform'), [ 'translate3d(1px,1px,0px)', 'matrix(1, 0, 0, 1, 1, 1)' ], 'matrix transformation applied');
				equal(t.css('color'), 'rgb(255, 0, 0)', 'color has followed with matrix transform');
			
				// avoidCSSTransitions
				t.css('-webkit-transform', '', true);
				t.css({top:'2px',left:'2px',color:'rgb(255,0,0)',avoidCSSTransitions:true});
				equal(t.css('-webkit-transform'), 'none', 'avoidCSSTransitions: no transform found');
				equal(t.css('top'),'2px', 'get top = 2px');
				equal(t.css('left'),'2px', 'get left = 2px');
			}); // end css test
			
			test('jQuery.fn.delay', function () {
				var t = $delay;
				
				// getter default
				contains(t.css('-webkit-transition-delay'), ['','0s'], 'no original delay');
				t.delay(2000, true); // force css3
				contains(t.css('-webkit-transition-delay'), ['2s','2000ms'], '2000 ms delay set');
				
				t.css('-webkit-transition-delay',''); // reset, do not use .stop here
				t.delay(500, true); // force css3
				contains(t.css('-webkit-transition-delay'), ['0.5s','500ms'], '500 ms delay set');
				
				stop(); // stop test execution
				
				setTimeout(function () {
					contains(t.css('-webkit-transition-delay'), ['','0s','0ms'], 'delay has been resetted');
					
					t.delay(100, false).animate({'line-height':'10px'}, 30);
					// verify that anim has not been started here
					contains(t.css('line-height'), ['auto','0px'], 'anim has not started');
					
					setTimeout(function () {
						// verify that anim is done
						equal(t.css('line-height'), '10px', 'anim has gone ok');
						
						start(); // restart test execution
					},150);	
				}, 501);
				
			}); // end delay test
			
			test('jQuery.fn.translation', function(){
				var t = $trans;
				
				// no translation
				containsAll(t.translation(),{x:0,y:0}, 'default translation to (0,0)');
				equal($().translation(), null, 'null on empty jQuery object');
				
				// apply css 3 translation
				t.css('-webkit-transform','translate(-21px,65px)', true);
				containsAll(t.translation(),{x:-21,y:65}, 'translation to (-21,65)');
				t.css('-webkit-transform','translate(1.5px,6.5px)', true);
				containsAll(t.translation(),{x:1.5,y:6.5}, 'translation to (1.5,6.5)');
				// overide with css 2
				t.css({top:'1px',left:'2px'});
				containsAll(t.translation(),{x:2,y:1}, 'translation to (2,1) with css 2');
			});
			
			
		}; // end run test
		
		$(runTests);
		})(jQuery);
	</script>
</body>
</html>